const router = require('express').Router()
const pgp = require('pg-promise')()

//database config
const config = {
	connectionString: process.env.DATABASE_URL || 'postgresql://postgres:Minenhle!28@localhost:5432/fema_app',
}
const db = pgp(config)

router.get('/', async (req, res) => {
    let users = await db.any('select * from users')
    res.json({
        users
    })
})

router.post('/register', async (req, res) => {
    let fullName = req.body.name
    let email = req.body.email
    let password = req.body.password
    await db.none('insert into users(full_name, email, password) values ($1, $2, $3)', [fullName, email, password])
    res.json('user registered successfully')
})

router.get('/services', async (req, res) => {
    const results = await db.many(`select services from facilities`);
    let services = [];

    results.forEach(result => {
        // console.log(result.services);
        //prevent duplicates
        result.services.forEach(service => {
            if (!services.includes(service)) {
                services.push(service);
            }
        });
       
    });
    res.json({
        services
    })
});

router.get('/services/:servicename', async (req, res) => {

    const {servicename} = req.params;
    const results = await db.oneOrNone(`select * from services where servicename = $1`, [servicename.toLowerCase()]);
    console.log(results);

    res.json({
        service: results
    })
});

router.post('/booking', async (req, res) => {
   
})

module.exports = router